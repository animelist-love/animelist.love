class P{constructor(){this.listeners=[],this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.push(e),this.onSubscribe(),()=>{this.listeners=this.listeners.filter(n=>n!==e),this.onUnsubscribe()}}hasListeners(){return this.listeners.length>0}onSubscribe(){}onUnsubscribe(){}}const C=typeof window>"u"||"Deno"in window;function T(){}function V(t,e){return typeof t=="function"?t(e):t}function $(t){return typeof t=="number"&&t>=0&&t!==1/0}function J(t,e){return Math.max(t+(e||0)-Date.now(),0)}function G(t,e,n){return b(t)?typeof e=="function"?{...n,queryKey:t,queryFn:e}:{...e,queryKey:t}:t}function W(t,e,n){return b(t)?[{...e,queryKey:t},n]:[t||{},e]}function X(t,e){const{type:n="all",exact:r,fetchStatus:s,predicate:u,queryKey:l,stale:a}=t;if(b(l)){if(r){if(e.queryHash!==Q(l,e.options))return!1}else if(!A(e.queryKey,l))return!1}if(n!=="all"){const f=e.isActive();if(n==="active"&&!f||n==="inactive"&&f)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||typeof s<"u"&&s!==e.state.fetchStatus||u&&!u(e))}function Y(t,e){const{exact:n,fetching:r,predicate:s,mutationKey:u}=t;if(b(u)){if(!e.options.mutationKey)return!1;if(n){if(E(e.options.mutationKey)!==E(u))return!1}else if(!A(e.options.mutationKey,u))return!1}return!(typeof r=="boolean"&&e.state.status==="loading"!==r||s&&!s(e))}function Q(t,e){return((e==null?void 0:e.queryKeyHashFn)||E)(t)}function E(t){return JSON.stringify(t,(e,n)=>O(n)?Object.keys(n).sort().reduce((r,s)=>(r[s]=n[s],r),{}):n)}function A(t,e){return M(t,e)}function M(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(n=>!M(t[n],e[n])):!1}function q(t,e){if(t===e)return t;const n=L(t)&&L(e);if(n||O(t)&&O(e)){const r=n?t.length:Object.keys(t).length,s=n?e:Object.keys(e),u=s.length,l=n?[]:{};let a=0;for(let f=0;f<u;f++){const y=n?f:s[f];l[y]=q(t[y],e[y]),l[y]===t[y]&&a++}return r===u&&a===r?t:l}return e}function Z(t,e){if(t&&!e||e&&!t)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function L(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function O(t){if(!j(t))return!1;const e=t.constructor;if(typeof e>"u")return!0;const n=e.prototype;return!(!j(n)||!n.hasOwnProperty("isPrototypeOf"))}function j(t){return Object.prototype.toString.call(t)==="[object Object]"}function b(t){return Array.isArray(t)}function R(t){return new Promise(e=>{setTimeout(e,t)})}function K(t){R(0).then(t)}function ee(){if(typeof AbortController=="function")return new AbortController}function te(t,e,n){return n.isDataEqual!=null&&n.isDataEqual(t,e)?t:typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?q(t,e):e}class U extends P{constructor(){super(),this.setup=e=>{if(!C&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),window.addEventListener("focus",n,!1),()=>{window.removeEventListener("visibilitychange",n),window.removeEventListener("focus",n)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.cleanup)==null||e.call(this),this.cleanup=void 0}}setEventListener(e){var n;this.setup=e,(n=this.cleanup)==null||n.call(this),this.cleanup=e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()})}setFocused(e){this.focused=e,e&&this.onFocus()}onFocus(){this.listeners.forEach(e=>{e()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const B=new U;class I extends P{constructor(){super(),this.setup=e=>{if(!C&&window.addEventListener){const n=()=>e();return window.addEventListener("online",n,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",n)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.cleanup)==null||e.call(this),this.cleanup=void 0}}setEventListener(e){var n;this.setup=e,(n=this.cleanup)==null||n.call(this),this.cleanup=e(r=>{typeof r=="boolean"?this.setOnline(r):this.onOnline()})}setOnline(e){this.online=e,e&&this.onOnline()}onOnline(){this.listeners.forEach(e=>{e()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const g=new I;function _(t){return Math.min(1e3*2**t,3e4)}function z(t){return(t??"online")==="online"?g.isOnline():!0}class D{constructor(e){this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}}function ne(t){return t instanceof D}function re(t){let e=!1,n=0,r=!1,s,u,l;const a=new Promise((o,c)=>{u=o,l=c}),f=o=>{r||(v(new D(o)),t.abort==null||t.abort())},y=()=>{e=!0},i=()=>{e=!1},h=()=>!B.isFocused()||t.networkMode!=="always"&&!g.isOnline(),k=o=>{r||(r=!0,t.onSuccess==null||t.onSuccess(o),s==null||s(),u(o))},v=o=>{r||(r=!0,t.onError==null||t.onError(o),s==null||s(),l(o))},F=()=>new Promise(o=>{s=c=>{const d=r||!h();return d&&o(c),d},t.onPause==null||t.onPause()}).then(()=>{s=void 0,r||t.onContinue==null||t.onContinue()}),w=()=>{if(r)return;let o;try{o=t.fn()}catch(c){o=Promise.reject(c)}Promise.resolve(o).then(k).catch(c=>{var d,S;if(r)return;const p=(d=t.retry)!=null?d:3,m=(S=t.retryDelay)!=null?S:_,N=typeof m=="function"?m(n,c):m,x=p===!0||typeof p=="number"&&n<p||typeof p=="function"&&p(n,c);if(e||!x){v(c);return}n++,t.onFail==null||t.onFail(n,c),R(N).then(()=>{if(h())return F()}).then(()=>{e?v(c):w()})})};return z(t.networkMode)?w():F().then(w),{promise:a,cancel:f,continue:()=>(s==null?void 0:s())?a:Promise.resolve(),cancelRetry:y,continueRetry:i}}function H(){let t=[],e=0,n=i=>{i()},r=i=>{i()};const s=i=>{let h;e++;try{h=i()}finally{e--,e||a()}return h},u=i=>{e?t.push(i):K(()=>{n(i)})},l=i=>(...h)=>{u(()=>{i(...h)})},a=()=>{const i=t;t=[],i.length&&K(()=>{r(()=>{i.forEach(h=>{n(h)})})})};return{batch:s,batchCalls:l,schedule:u,setNotifyFunction:i=>{n=i},setBatchNotifyFunction:i=>{r=i}}}const se=H();export{P as S,C as a,se as b,re as c,ne as d,z as e,Y as f,ee as g,Q as h,$ as i,B as j,G as k,V as l,X as m,T as n,g as o,W as p,E as q,te as r,A as s,J as t,Z as u};
